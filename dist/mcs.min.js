"use strict";(function(){var e=function(){var e=function e(t){if(!t||typeof t!=="string"){var n="Error: Object to parse is not a valid string or does not exist.";console.error(n);return n}var r=["advancement","ban","blockdata","clear","clone","debug","defaultgamemode","deop","difficulty","effect","enchant","entitydata","execute","fill","function","gamemode","gamerule","give","help","kick","kill","list","locate","me","op","pardon","particle","playsound","publish","recipe","reload","replaceitem","save","say","scoreboard","seed","setblock","setidletimeout","setmaxplayers","setworldspawn","spawnpoint","spreadplayers","stats","stop","stopsound","summon","teleport","tell","tellraw","testfor","testforblock","testforblocks","time","title","toggledownfall","tp","transferserver","trigger","weather","whitelist","worldborder","wsserver","xp"];function u(e){var t=0,n=1,r=0,u=null,i=true;return{next:o,peek:l,eof:c,croak:s,last:a,lastWasNewLine:f};function o(){if(l()=="\n")i=true;else if("\r\t ".indexOf(l())==-1)i=false;u=l();var o=e.charAt(t++);if(o=="\n")n++,r=0;else r++;return o}function a(){return u}function f(){return i}function l(){return e.charAt(t)}function c(){return l()==""}function s(e){var t=e+" at ("+n+":"+r+")";console.error(t);throw new Error(t)}}function i(e){var t=null;var n=" function macro group if elseif else return execute true false var for foreach in ";var r=null;return{next:j,peek:S,eof:z,croak:e.croak,last:W};function o(e){return n.indexOf(" "+e+" ")>=0}function f(e){return/[0-9]/i.test(e)}function l(e){return/[a-z0-9-_\$]/i.test(e)}function c(e){return l(e)}function s(e){return/\$[a-z0-9-_]/i.test(e)}function p(e){return"+-*/%=&|<>!".indexOf(e)>=0}function v(e){return",;(){}[]".indexOf(e)>=0}function y(e){return" \t\n\r".indexOf(e)>=0}function g(t){var n="";while(!e.eof()&&t(e.peek())){n+=e.next()}return n}function d(){var e=false;var t=g(function(t){if(t=="."){if(e)return false;e=true;return true}return f(t)});return{type:"num",value:parseFloat(t)}}function m(){var e=g(c);var t;if(o(e))t="kw";else if(s(e))t="ivar";else t="reg";return{type:t,value:e}}function x(t){var n=false,r="";e.next();while(!e.eof()){var u=e.next();if(n){r+=u;n=false}else if(u=="\\"){n=true}else if(u==t){break}else{r+=u}}return r}function k(t){if(t.indexOf("`")>=0){var n=false,r=[],o="";var f=t.split("");for(var l=0;l<f.length;l++){var c=f[l];if(n){if(c=="`"){n=false;var s=a(i(u(o)));if(s.prog.length!=0){for(var p=0;p<s.prog.length;p++){if(s.prog[p].type=="comment"){e.croak("Comments are not allowed in evaluation blocks")}else if(s.prog[p].type=="function"){e.croak("Functions are not allowed in evaluation blocks")}else if(s.prog[p].type=="macro"){e.croak("Creating macros is not allowed in evaluation blocks")}}r.push(s)}o=""}else{o+=c;if(l==f.length-1){if(o)r.push({type:"str",value:o})}}}else{if(c=="`"){n=true;if(o)r.push({type:"str",value:o});o=""}else{o+=c;if(l==f.length-1){if(o)r.push({type:"str",value:o})}}}}return r}else{return t}}function h(){return{type:"str",value:k(x('"'))}}function b(){var t=e.lastWasNewLine();e.next();if(e.peek()=="!"){if(!t)e.croak('Settings with "@!" need to start at the begining of a line');return O()}else{return w()}}function w(){var e=g(function(e){return!y(e)&&e!=";"});return{type:"selector",value:"@"+e}}function O(){var e=g(function(e){return e!="\n"});return{type:"setting",value:e.replace("\r","")}}function E(){e.next();return{type:"relative"}}function C(){e.next();return{type:"colon"}}function N(){if(!e.lastWasNewLine())e.croak('Comments with "#" need to start at the begining of a line');var t=g(function(e){return e!="\n"});return{type:"comment",value:t}}function A(){g(function(e){return e!="\n"});e.next()}function F(){var t=g(function(e){return e=="/"});if(t=="//"){A()}else{e.next()}}function L(){g(y);if(e.eof())return null;var t=e.peek();if(t=="#"){return N()}if(t=="/"){F();return L()}if(t=="@")return b();if(t=='"')return h();if(t=="~")return E();if(t==":")return C();if(f(t))return d();if(l(t))return m();if(v(t))return{type:"punc",value:e.next()};if(p(t))return{type:"op",value:g(p)};e.croak("Can't handle character: "+t)}function S(){return t||(t=L())}function W(){return r}function j(){r=S();var e=t;t=null;return e||L()}function z(){return S()==null}}var o={type:"bool",value:false};function a(e){var t={"=":1,"||":2,"&&":3,"<":7,">":7,"<=":7,">=":7,"==":7,"!=":7,"+":10,"-":10,"*":20,"/":20,"%":20};return _();function n(t){var n=e.peek();return n&&n.type=="punc"&&(!t||n.value==t)&&n}function u(t){var n=e.peek();return n&&n.type=="kw"&&(!t||n.value==t)&&n}function i(t){var n=e.peek();return n&&n.type=="op"&&(!t||n.value==t)&&n}function a(){var t=e.peek();return t&&t.type=="comment"}function f(){var t=e.peek();return t&&t.type=="reg"}function l(t){if(n(t))e.next();else e.croak('Expecting punctuation: "'+t+'"')}function c(t){if(a())S();e.next()}function s(t){if(u(t))e.next();else e.croak('Expecting keyword: "'+t+'"')}function p(t){if(i(t))e.next();else e.croak('Expecting operator: "'+t+'"')}function v(){e.croak("Unexpected token: "+JSON.stringify(e.peek()))}function y(n,r){var u=i();if(u){var o=t[u.value];if(o>r){e.next();return y({type:u.value=="="?"assign":"binary",operator:u.value,left:n,right:y(U(),o)},r)}}return n}function g(t,r,u,i){var o=[],a=true;l(t);while(!e.eof()){if(n(r))break;if(a)a=false;else if($())l(u);if(n(r))break;o.push(i())}l(r);return o}function d(e){return{type:"call",func:e,args:g("(",")",",",H)}}function m(){var t=e.next();if(t.type!="ivar")e.croak("Expecting variable name");return t.value}function x(){s("if");var t=g("(",")",",",H);var n=H();var r={type:"if",cond:t,then:n};if(u("else")){e.next();r.else=H()}return r}function k(){s("var");return{type:"var",value:m()}}function h(){s("for");var e=g("(",")",";",H);var t=H();return{type:"for",params:e,then:t}}function b(){s("foreach");l("(");s("var");var e=F();s("in");var t=H();l(")");var n=H();return{type:"foreach",variable:e,param:t,then:n}}function w(){e.next();var t=e.next();if(e.peek().type=="colon"){var r={type:"command",value:[{type:"reg",value:"function"},t]};while(!e.eof()){r.value.push(e.next());if(n(";"))break;else if(e.eof())l(";")}return r}else{return{type:"function",name:t.value,body:H()}}}function O(){e.next();return{type:"group",name:e.next().value,body:H()}}function E(){e.next();return{type:"macro",name:e.next().value,vars:g("(",")",",",m),body:H()}}function C(){e.next();return{type:"return",value:H()}}function N(){e.next();var t={type:"execute",selector:"",pos:[]};var r=0;while(!e.eof()){if(r==5){break}else{var u=H();if(r==0)t.selector=u;else if(r>0&&r<4)t.pos.push(u);else if(r==4)t.prog=u;r++;if(r==4&&!n("{"))v()}}return t}function A(){return{type:"bool",value:e.next().value=="true"}}function F(){var t=e.next();if(n("[")){l("[");while(!e.eof()){if(n("]"))break;if(e.peek().type=="kw")v();t.index=H();if(n("]"))break;else e.croak('Expecting punctuation: "]"')}l("]")}return t}function L(){return{type:"array",value:g("[","]",",",function t(){var n=e.peek();if(n.type=="kw"&&n.value!="false"&&n.value!="true"&&n.value!="macro")v();else return H()})}}function S(){return{type:"comment",value:e.next().value}}function W(){var t=e.next().value.trim();var n=t.indexOf(":");if(n==-1)e.croak('Expecting separator: ":"');return{type:"setting",name:t.substring(t.indexOf("!")+1,n).trim(),value:t.substring(n+1).trim()}}var j;function z(){var t={type:"command",value:[]};if(r.includes(e.peek().value)){while(!e.eof()){t.value.push(e.next());if(n(";"))break;else if(e.eof())l(";")}return t}else{return e.next()}}function M(e){e=e();return n("(")?d(e):e}function U(){return M(function(){if(n("(")){e.next();var t=H();l(")");return t}if(n("{"))return G();if(n("["))return L();if(u("if"))return x();if(u("var"))return k();if(u("true")||u("false"))return A();if(u("for"))return h();if(u("foreach"))return b();if(u("function"))return w();if(u("group"))return O();if(u("execute"))return N();if(u("macro"))return E();if(u("return"))return C();if(a())return S();if(e.peek().type=="reg")return z();if(e.peek().type=="setting")return W();if(e.peek().type=="ivar")return F();var r=e.next();if(r.type=="colon"||r.type=="relative"||r.type=="selector"||r.type=="num"||r.type=="str")return r;v()})}function $(){return!e.last()||e.last()&&e.last().type!="comment"&&e.last().type!="setting"}function _(){var t=[];while(!e.eof()){t.push(H());if(a()){t.push(S())}else if(!e.eof()&&$())l(";")}return{type:"prog",prog:t}}function G(){var e=g("{","}",";",H);if(e.length==0)return o;if(e.length==1)return e[0];return{type:"prog",prog:e}}function H(){return M(function(){return y(U(),0)})}}var f=a(i(u(t)));return f};e.help=function e(){console.log(["    mcs","    A simple and easy to use scripting language which compiles into Minecraft functions.","","    Usage:","    var output = mcs(input) - Converts MCS language into an object of function files","","    Check the GitHub repository for more info: https://github.com/PandawanFr/mcs"])};return e}();if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=e}else{if(typeof define==="function"&&define.amd){define([],function(){return e})}else{window.mcs=e}}})();